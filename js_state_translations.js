const TRANSLATIONS = {
  en: {
    // App
    app_name: 'SKILLOPS',
    authority: 'AUTHORITY',
    field: 'FIELD',
    // Nav
    nav_dashboard: 'Dashboard',
    nav_matrix: 'Skills Matrix',
    nav_approvals: 'Approvals',
    nav_cross: '3×3 Training',
    nav_rotation: 'Rotation',
    nav_attendance: 'Attendance',
    nav_audits: 'Audits',
    nav_import_export: 'Import / Export',
    nav_qr: 'QR Codes',
    nav_reports: 'Reports',
    nav_setup: 'Setup',
    nav_sync: 'Sync',
    nav_section_overview: 'Overview',
    nav_section_skills: 'Skills',
    nav_section_ops: 'Operations',
    nav_section_data: 'Data',
    // Pages
    page_dashboard: 'Dashboard',
    page_matrix: 'Skills Matrix',
    page_approvals: 'Skill Approvals',
    page_cross: '3×3 Cross-Training',
    page_rotation: 'Rotation Planner',
    page_attendance: 'Attendance',
    page_audits: 'Standard Work Audits',
    page_import_export: 'Import / Export',
    page_qr: 'QR Codes',
    page_reports: 'Reports',
    page_setup: 'Setup',
    page_sync: 'Sync',
    // Session
    session_title: 'Select Your Session',
    session_who: 'Who are you?',
    session_continue: 'Continue',
    session_no_users: 'No users configured. Go to Setup → Users.',
    session_switch: 'Switch User',
    logging_as: 'Logging as',
    // Provision
    provision_title: 'Device Setup Required',
    provision_desc: 'Load a device seed file to provision this field device.',
    provision_load: 'Load Device Seed File',
    provision_hint: 'Seed files are generated on the authority device under Setup → Devices',
    provision_success: 'Device provisioned successfully',
    provision_error: 'Invalid seed file',
    // Levels
    level_0: 'Not Trained',
    level_1: 'Identified',
    level_2: 'In Training',
    level_3: 'Independent',
    level_4: 'Trainer',
    level_short_0: '—',
    level_short_1: 'L1',
    level_short_2: 'L2',
    level_short_3: 'L3',
    level_short_4: 'L4',
    // Approvals
    promote: 'Promote',
    demote: 'Demote',
    approve: 'Approve',
    pending_dual: 'Pending 2nd Approval',
    approved: 'Approved',
    your_name: 'Your Name',
    your_role: 'Your Role',
    comment_optional: 'Comment (optional)',
    promote_to: 'Promote to',
    demote_to: 'Demote to Level',
    reason_required: 'Reason (required)',
    confirm_demotion: 'Confirm Demotion',
    demotion_reason_placeholder: 'Reason for demotion (required)...',
    second_approval: 'Add Second Approval',
    training_recommended: 'Level Change Suggested',
    history: 'History',
    approval_chain: 'Approval Chain',
    no_history: 'No history recorded',
    err_same_person: 'Same person cannot sign twice',
    err_need_supervisor: 'At least one approver must be a Supervisor for L3/L4',
    err_reason_required: 'Reason is required for demotion',
    err_max_level: 'Already at maximum level (L4)',
    err_no_name: 'Enter your name to continue',
    // Attendance
    status: 'Status',
    present: 'Present',
    absent_approved: 'Absent (Approved)',
    absent_unapproved: 'Absent (Unapproved)',
    partial: 'Partial Day',
    partial_hours: 'Hours',
    notes: 'Notes',
    save_attendance: 'Save Attendance',
    attendance_saved: 'Attendance saved',
    today_attendance: "Today's Attendance",
    // Rotation
    rotation_date: 'Date',
    bb_mode: 'BB Mode (Critical Only)',
    generate: 'Generate Rotation',
    period_a: 'Period A — Before Break',
    period_b: 'Period B — After Break',
    period_c: 'Period C — After Lunch',
    violations: 'Violations',
    coverage_gaps: 'Coverage Gaps',
    training_suggestions: 'Training Suggestions',
    violation_repeat: 'REPEAT',
    violation_double: 'DOUBLE',
    violation_underqualified: 'L2 ONLY',
    gap_label: 'OPEN',
    bb_skipped: 'BB—SKIPPED',
    who_train: 'Who to Train Next',
    urgency: 'Urgency',
    candidates: 'Candidates',
    not_started: 'Not Started',
    generating: 'Generating…',
    rotation_clean: 'Clean rotation — no violations',
    // 3x3
    by_position: 'By Position',
    by_person: 'By Person',
    recommendations: 'Recommendations',
    met: 'Met',
    partial_status: 'Partial',
    critical_status: 'Critical',
    positions_met: 'Positions Met',
    employees_met: 'Employees Met',
    all_met: 'All 3×3 targets met!',
    // Audits
    todays_audit: "Today's Assigned Audit",
    audit_history: 'Audit History',
    pass: 'Pass',
    fail: 'Fail',
    audit_notes: 'Observations',
    log_audit: 'Log Result',
    cycle_reset: 'Cycle reset — all positions eligible',
    no_positions_audit: 'No positions on this line',
    audit_pass_rate: 'Pass Rate',
    // Import/Export
    upload_template: 'Upload Excel Template',
    upload_matrix: 'Import Skills Matrix',
    export_excel: 'Export to Excel',
    template_tab: 'Template',
    import_tab: 'Import',
    export_tab: 'Export',
    mapping_review: 'Mapping Review',
    confirm_mapping: 'Confirm & Save Mapping',
    detection_method: 'Detection Method',
    header_row: 'Header Row (1-based)',
    roster_col: 'Roster Column (e.g. A)',
    first_pos_col: 'First Position Column (e.g. C)',
    first_roster_row: 'First Roster Row (1-based)',
    validate_mapping: 'Validate',
    import_complete: 'Import complete',
    new_employees: 'new employees',
    new_positions: 'new positions',
    skill_records: 'skill records',
    no_template: 'No template found — upload a template first',
    no_xlsx: 'SheetJS library not loaded',
    xlsx_instructions: 'Download xlsx.full.min.js to libs/ folder',
    template_saved: 'Template mapping saved',
    template_manual: 'Mapping saved (manual override)',
    drop_excel: 'Drop Excel file here or click to browse',
    excel_formats: '.xlsx or .xls',
    analyzing: 'Analyzing…',
    importing: 'Importing…',
    validation_pass: 'Validation passed',
    validation_fail: 'Validation failed',
    // QR
    qr_desc: 'Print and post on the line. Scan with any QR reader to confirm line context.',
    qr_url_label: 'Encoded Value',
    print_qr: 'Print QR',
    open_form: 'Open Log Form',
    qr_note: 'QR scanner is optional. Add libs/qrcode.min.js for higher quality.',
    log_training: 'Log Training Session',
    trainee: 'Trainee',
    trainer: 'Trainer / TL (optional)',
    position: 'Position',
    duration: 'Duration (minutes)',
    duration_hint: '1–480 min',
    recommend_level: 'Recommend skill level advancement',
    submit_log: 'Log Training Session',
    log_saved: 'Training session logged',
    log_recommend_note: 'Supervisor will be notified to review.',
    none_option: '— None —',
    select_trainee: '— Select trainee —',
    select_position: '— Select position —',
    select_line: '— Select line —',
    trainer_eq_trainee: 'Trainer and trainee cannot be the same person',
    duration_required: 'Enter a duration (1–480 min)',
    duration_min: 'Minimum 1 minute',
    duration_max: 'Maximum 480 minutes',
    duplicate_log: 'A log for this trainee + position was submitted recently. Submit again?',
    // Sync
    sync_export: 'Export Delta Bundle',
    sync_import: 'Import Delta Bundle',
    sync_receipt: 'Import Sync Receipt',
    sync_pending_logs: 'Training logs pending sync',
    sync_pending_recs: 'Recommendations pending sync',
    sync_last: 'Last synced',
    sync_never: 'Never',
    sync_exported: 'Bundle exported',
    sync_imported: 'Bundle imported',
    sync_nothing: 'Nothing to sync',
    sync_seed_warn: 'Field device roster may be outdated',
    imported: 'imported',
    skipped: 'skipped',
    errors: 'errors',
    unresolved: 'unresolved',
    download_receipt: 'Download Receipt',
    review_unresolved: 'Review Unresolved',
    // Setup
    setup_lines: 'Lines',
    setup_employees: 'Employees',
    setup_positions: 'Positions',
    setup_users: 'Users',
    setup_devices: 'Devices',
    add_line: 'Add Line',
    add_employee: 'Add Employee',
    add_position: 'Add Position',
    add_user: 'Add User',
    line_name: 'Line Name',
    shift: 'Shift',
    shift_day: 'Day',
    shift_afternoon: 'Afternoon',
    shift_night: 'Night',
    shift_multi: 'Multi-shift',
    employee_name: 'Employee Name',
    role: 'Role',
    role_operator: 'Operator',
    role_teamlead: 'Team Lead',
    role_supervisor: 'Supervisor',
    role_admin: 'Admin',
    position_name: 'Position Name',
    critical: 'Critical',
    critical_note: 'Critical positions fill first in BB mode',
    supervisor_only: 'Supervisor access required',
    no_employees: 'No employees on this line',
    no_positions: 'No positions on this line',
    no_lines: 'No lines configured',
    no_users: 'No users configured',
    select_line_first: 'Select a line first',
    line_added: 'Line added',
    employee_added: 'Employee added',
    position_added: 'Position added',
    user_added: 'User added',
    deleted: 'Deleted',
    confirm_delete: 'Are you sure? This cannot be undone.',
    deactivated: 'Deactivated',
    provision_device: 'Provision Field Device',
    generate_seed: 'Generate Seed File',
    // Dashboard
    team_members: 'Team Members',
    present_today: 'present today',
    positions_label: 'Positions',
    critical_count: 'critical',
    pending_approvals: 'Pending Approvals',
    awaiting_sig: 'awaiting 2nd signature',
    audit_pass_dash: 'Audit Pass Rate',
    total_audits_dash: 'total audits',
    recent_logs: 'Recent Training Logs',
    coverage_by_pos: '3×3 Coverage',
    top_priorities: 'Top Training Priorities',
    view_matrix: 'View Matrix →',
    no_logs_yet: 'No training logs yet',
    no_priorities: 'All 3×3 targets met!',
    l3_qualified: 'L3+ Qualified',
    // Table headers
    col_employee: 'Employee',
    col_position: 'Position',
    col_level: 'Level',
    col_status: 'Status',
    col_date: 'Date',
    col_trainer: 'Trainer',
    col_duration: 'Min',
    col_rec: 'Rec',
    col_actions: 'Actions',
    col_shift: 'Shift',
    col_count: 'Count',
    col_result: 'Result',
    col_name: 'Name',
    col_role: 'Role',
    col_critical: 'Critical',
    col_l3plus: 'L3+ Count',
    col_3x3: '3×3 Status',
    // General
    save: 'Save',
    cancel: 'Cancel',
    delete: 'Delete',
    deactivate: 'Deactivate',
    edit: 'Edit',
    close: 'Close',
    confirm: 'Confirm',
    loading: 'Loading…',
    no_line_selected: 'Select a line to begin.',
    select_line: 'Select Line',
    unknown: 'Unknown',
    min: 'min',
    yes: 'Yes',
    no: 'No',
    na: 'N/A',
    all_lines: 'All Lines',
    shift_label: 'Shift',
    line_label: 'Line',
  },
  es: {
    app_name: 'SKILLOPS',
    authority: 'AUTORIDAD',
    field: 'CAMPO',
    nav_dashboard: 'Tablero',
    nav_matrix: 'Matriz de Habilidades',
    nav_approvals: 'Aprobaciones',
    nav_cross: 'Capacitación 3×3',
    nav_rotation: 'Rotación',
    nav_attendance: 'Asistencia',
    nav_audits: 'Auditorías',
    nav_import_export: 'Importar / Exportar',
    nav_qr: 'Códigos QR',
    nav_reports: 'Reportes',
    nav_setup: 'Configuración',
    nav_sync: 'Sincronizar',
    nav_section_overview: 'Resumen',
    nav_section_skills: 'Habilidades',
    nav_section_ops: 'Operaciones',
    nav_section_data: 'Datos',
    page_dashboard: 'Tablero',
    page_matrix: 'Matriz de Habilidades',
    page_approvals: 'Aprobaciones de Habilidades',
    page_cross: 'Capacitación Cruzada 3×3',
    page_rotation: 'Planificador de Rotación',
    page_attendance: 'Asistencia',
    page_audits: 'Auditorías de Trabajo Estándar',
    page_import_export: 'Importar / Exportar',
    page_qr: 'Códigos QR',
    page_reports: 'Reportes',
    page_setup: 'Configuración',
    page_sync: 'Sincronizar',
    session_title: 'Selecciona tu Sesión',
    session_who: '¿Quién eres?',
    session_continue: 'Continuar',
    session_no_users: 'Sin usuarios. Ve a Configuración → Usuarios.',
    session_switch: 'Cambiar Usuario',
    logging_as: 'Registrando como',
    provision_title: 'Configuración Requerida',
    provision_desc: 'Carga un archivo semilla para configurar este dispositivo de campo.',
    provision_load: 'Cargar Archivo Semilla',
    provision_hint: 'Los archivos semilla se generan en el dispositivo de autoridad',
    provision_success: 'Dispositivo configurado exitosamente',
    provision_error: 'Archivo semilla inválido',
    level_0: 'No Capacitado',
    level_1: 'Identificado',
    level_2: 'En Capacitación',
    level_3: 'Independiente',
    level_4: 'Capacitador',
    level_short_0: '—',
    level_short_1: 'N1',
    level_short_2: 'N2',
    level_short_3: 'N3',
    level_short_4: 'N4',
    promote: 'Promover',
    demote: 'Degradar',
    approve: 'Aprobar',
    pending_dual: 'Pendiente 2da Aprobación',
    approved: 'Aprobado',
    your_name: 'Tu Nombre',
    your_role: 'Tu Rol',
    comment_optional: 'Comentario (opcional)',
    promote_to: 'Promover a',
    demote_to: 'Degradar al Nivel',
    reason_required: 'Razón (requerida)',
    confirm_demotion: 'Confirmar Degradación',
    demotion_reason_placeholder: 'Razón para la degradación (requerida)...',
    second_approval: 'Segunda Aprobación',
    training_recommended: 'Cambio de Nivel Sugerido',
    history: 'Historial',
    approval_chain: 'Cadena de Aprobación',
    no_history: 'Sin historial',
    err_same_person: 'La misma persona no puede firmar dos veces',
    err_need_supervisor: 'Al menos un aprobador debe ser Supervisor para N3/N4',
    err_reason_required: 'La razón es requerida para una degradación',
    err_max_level: 'Ya está en el nivel máximo (N4)',
    err_no_name: 'Ingresa tu nombre para continuar',
    status: 'Estado',
    present: 'Presente',
    absent_approved: 'Ausente (Justificado)',
    absent_unapproved: 'Ausente (No Justificado)',
    partial: 'Día Parcial',
    partial_hours: 'Horas',
    notes: 'Notas',
    save_attendance: 'Guardar Asistencia',
    attendance_saved: 'Asistencia guardada',
    today_attendance: 'Asistencia de Hoy',
    rotation_date: 'Fecha',
    bb_mode: 'Modo BB (Solo Críticos)',
    generate: 'Generar Rotación',
    period_a: 'Período A — Antes del Receso',
    period_b: 'Período B — Después del Receso',
    period_c: 'Período C — Después del Almuerzo',
    violations: 'Violaciones',
    coverage_gaps: 'Brechas de Cobertura',
    training_suggestions: 'Sugerencias de Capacitación',
    violation_repeat: 'REPETIDO',
    violation_double: 'DOBLE',
    violation_underqualified: 'SOLO N2',
    gap_label: 'ABIERTO',
    bb_skipped: 'BB-OMITIDO',
    who_train: 'A Quién Capacitar',
    urgency: 'Urgencia',
    candidates: 'Candidatos',
    not_started: 'Sin Iniciar',
    generating: 'Generando…',
    rotation_clean: 'Rotación limpia — sin violaciones',
    by_position: 'Por Puesto',
    by_person: 'Por Persona',
    recommendations: 'Recomendaciones',
    met: 'Cumplido',
    partial_status: 'Parcial',
    critical_status: 'Crítico',
    positions_met: 'Puestos Cumplidos',
    employees_met: 'Empleados Cumplidos',
    all_met: '¡Todos los objetivos 3×3 cumplidos!',
    todays_audit: 'Auditoría Asignada de Hoy',
    audit_history: 'Historial de Auditorías',
    pass: 'Pasa',
    fail: 'Falla',
    audit_notes: 'Observaciones',
    log_audit: 'Registrar Resultado',
    cycle_reset: 'Ciclo reiniciado — todos los puestos elegibles',
    no_positions_audit: 'Sin puestos en esta línea',
    audit_pass_rate: 'Tasa de Aprobación',
    upload_template: 'Cargar Plantilla Excel',
    upload_matrix: 'Importar Matriz de Habilidades',
    export_excel: 'Exportar a Excel',
    template_tab: 'Plantilla',
    import_tab: 'Importar',
    export_tab: 'Exportar',
    mapping_review: 'Revisión de Mapeo',
    confirm_mapping: 'Confirmar y Guardar Mapeo',
    detection_method: 'Método de Detección',
    header_row: 'Fila de Encabezado (base 1)',
    roster_col: 'Columna de Nómina (ej. A)',
    first_pos_col: 'Primera Columna de Puesto (ej. C)',
    first_roster_row: 'Primera Fila de Nómina (base 1)',
    validate_mapping: 'Validar',
    import_complete: 'Importación completada',
    new_employees: 'nuevos empleados',
    new_positions: 'nuevos puestos',
    skill_records: 'registros de habilidades',
    no_template: 'Sin plantilla — sube una plantilla primero',
    no_xlsx: 'Biblioteca SheetJS no cargada',
    xlsx_instructions: 'Descarga xlsx.full.min.js a la carpeta libs/',
    template_saved: 'Mapeo de plantilla guardado',
    template_manual: 'Mapeo guardado (ajuste manual)',
    drop_excel: 'Suelta el archivo Excel aquí o haz clic',
    excel_formats: '.xlsx o .xls',
    analyzing: 'Analizando…',
    importing: 'Importando…',
    validation_pass: 'Validación exitosa',
    validation_fail: 'Validación fallida',
    qr_desc: 'Imprime y pega en la línea.',
    qr_url_label: 'Valor Codificado',
    print_qr: 'Imprimir QR',
    open_form: 'Abrir Formulario',
    qr_note: 'El escáner QR es opcional.',
    log_training: 'Registrar Sesión de Capacitación',
    trainee: 'Aprendiz',
    trainer: 'Capacitador / TL (opcional)',
    position: 'Puesto',
    duration: 'Duración (minutos)',
    duration_hint: '1–480 min',
    recommend_level: 'Recomendar avance de nivel',
    submit_log: 'Registrar Capacitación',
    log_saved: 'Sesión registrada',
    log_recommend_note: 'El supervisor será notificado.',
    none_option: '— Ninguno —',
    select_trainee: '— Seleccionar aprendiz —',
    select_position: '— Seleccionar puesto —',
    select_line: '— Seleccionar línea —',
    trainer_eq_trainee: 'Capacitador y aprendiz no pueden ser la misma persona',
    duration_required: 'Ingresa una duración (1–480 min)',
    duration_min: 'Mínimo 1 minuto',
    duration_max: 'Máximo 480 minutos',
    duplicate_log: 'Se registró una sesión reciente para este aprendiz y puesto. ¿Registrar de nuevo?',
    sync_export: 'Exportar Paquete Delta',
    sync_import: 'Importar Paquete Delta',
    sync_receipt: 'Importar Recibo',
    sync_pending_logs: 'Registros pendientes de sincronización',
    sync_pending_recs: 'Recomendaciones pendientes',
    sync_last: 'Última sincronización',
    sync_never: 'Nunca',
    sync_exported: 'Paquete exportado',
    sync_imported: 'Paquete importado',
    sync_nothing: 'Nada que sincronizar',
    sync_seed_warn: 'La nómina del dispositivo puede estar desactualizada',
    imported: 'importados',
    skipped: 'omitidos',
    errors: 'errores',
    unresolved: 'no resueltos',
    download_receipt: 'Descargar Recibo',
    review_unresolved: 'Revisar No Resueltos',
    setup_lines: 'Líneas',
    setup_employees: 'Empleados',
    setup_positions: 'Puestos',
    setup_users: 'Usuarios',
    setup_devices: 'Dispositivos',
    add_line: 'Agregar Línea',
    add_employee: 'Agregar Empleado',
    add_position: 'Agregar Puesto',
    add_user: 'Agregar Usuario',
    line_name: 'Nombre de Línea',
    shift: 'Turno',
    shift_day: 'Día',
    shift_afternoon: 'Tarde',
    shift_night: 'Noche',
    shift_multi: 'Múltiple turno',
    employee_name: 'Nombre del Empleado',
    role: 'Rol',
    role_operator: 'Operador',
    role_teamlead: 'Líder de Equipo',
    role_supervisor: 'Supervisor',
    role_admin: 'Admin',
    position_name: 'Nombre del Puesto',
    critical: 'Crítico',
    critical_note: 'Los puestos críticos se llenan primero en Modo BB',
    supervisor_only: 'Acceso de Supervisor requerido',
    no_employees: 'Sin empleados en esta línea',
    no_positions: 'Sin puestos en esta línea',
    no_lines: 'Sin líneas configuradas',
    no_users: 'Sin usuarios configurados',
    select_line_first: 'Selecciona una línea primero',
    line_added: 'Línea agregada',
    employee_added: 'Empleado agregado',
    position_added: 'Puesto agregado',
    user_added: 'Usuario agregado',
    deleted: 'Eliminado',
    confirm_delete: '¿Estás seguro? No se puede deshacer.',
    deactivated: 'Desactivado',
    provision_device: 'Configurar Dispositivo',
    generate_seed: 'Generar Archivo Semilla',
    team_members: 'Integrantes',
    present_today: 'presentes hoy',
    positions_label: 'Puestos',
    critical_count: 'críticos',
    pending_approvals: 'Aprobaciones Pendientes',
    awaiting_sig: 'esperando 2da firma',
    audit_pass_dash: 'Tasa de Auditoría',
    total_audits_dash: 'auditorías totales',
    recent_logs: 'Registros Recientes',
    coverage_by_pos: 'Cobertura 3×3',
    top_priorities: 'Prioridades de Capacitación',
    view_matrix: 'Ver Matriz →',
    no_logs_yet: 'Sin registros aún',
    no_priorities: '¡Todos los objetivos 3×3 cumplidos!',
    l3_qualified: 'Calificados N3+',
    col_employee: 'Empleado',
    col_position: 'Puesto',
    col_level: 'Nivel',
    col_status: 'Estado',
    col_date: 'Fecha',
    col_trainer: 'Capacitador',
    col_duration: 'Min',
    col_rec: 'Rec',
    col_actions: 'Acciones',
    col_shift: 'Turno',
    col_count: 'Conteo',
    col_result: 'Resultado',
    col_name: 'Nombre',
    col_role: 'Rol',
    col_critical: 'Crítico',
    col_l3plus: 'Conteo N3+',
    col_3x3: 'Estado 3×3',
    save: 'Guardar',
    cancel: 'Cancelar',
    delete: 'Eliminar',
    deactivate: 'Desactivar',
    edit: 'Editar',
    close: 'Cerrar',
    confirm: 'Confirmar',
    loading: 'Cargando…',
    no_line_selected: 'Selecciona una línea para comenzar.',
    select_line: 'Seleccionar Línea',
    unknown: 'Desconocido',
    min: 'min',
    yes: 'Sí',
    no: 'No',
    na: 'N/D',
    all_lines: 'Todas las Líneas',
    shift_label: 'Turno',
    line_label: 'Línea',
  }
};

function t(key) {
  const lang = window._LANG || 'en';
  const dict = TRANSLATIONS[lang] || TRANSLATIONS.en;
  if (!(key in dict)) {
    console.warn(`[i18n] Missing key: "${key}" (lang: ${lang})`);
    return key;
  }
  return dict[key];
}

function applyTranslations(root = document) {
  root.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  root.querySelectorAll('[data-i18n-ph]').forEach(el => {
    el.placeholder = t(el.dataset.i18nPh);
  });
  root.querySelectorAll('[data-i18n-title]').forEach(el => {
    el.title = t(el.dataset.i18nTitle);
  });
}
